# Worker Module Configuration
# This module handles background job processing using JobRunr

spring:
  application:
    name: {{.ProjectName}}-worker
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:local}

# Server configuration (for actuator health endpoints)
server:
  port: 8081

# Management/Actuator endpoints
management:
  server:
    port: 8082
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      probes:
        enabled: true
      show-details: when_authorized

# JobRunr Configuration
org:
  jobrunr:
    # Enable the background job server (processes jobs)
    background-job-server:
      enabled: true
      # Number of worker threads (default: 2x CPU cores)
      # worker-count: 4
    # Enable the dashboard (http://localhost:8000)
    dashboard:
      enabled: true
      port: 8000
    # Job configuration
    jobs:
      # Default number of retries (with exponential backoff)
      default-number-of-retries: 10
      # How often to check for new jobs (in seconds)
      # poll-interval-in-seconds: 15
    # Database configuration (uses Spring datasource automatically)
    database:
      # Skip database creation (set to false to auto-create tables)
      skip-create: false
{{if .HasModule "SQLDatastore"}}
      # Use SQL storage (auto-detected from spring.datasource)
      type: sql
{{end}}
{{if .HasModule "NoSQLDatastore"}}
{{if eq .NoSQLDatabase "mongodb"}}
      # Use MongoDB storage
      type: mongodb
{{else if eq .NoSQLDatabase "redis"}}
      # Use Redis storage
      type: redis-lettuce
{{end}}
{{end}}

# Logging
logging:
  level:
    root: INFO
    {{.GroupID}}.worker: DEBUG
    org.jobrunr: INFO
