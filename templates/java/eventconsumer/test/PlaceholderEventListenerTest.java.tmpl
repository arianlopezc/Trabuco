package {{.GroupID}}.eventconsumer.listener;

import {{.GroupID}}.model.events.PlaceholderCreatedEvent;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
{{- if .UsesSQS}}
import org.mockito.Mock;
import io.awspring.cloud.sqs.listener.acknowledgement.Acknowledgement;
{{- else if .UsesPubSub}}
import org.mockito.Mock;
import com.google.cloud.spring.pubsub.support.BasicAcknowledgeablePubsubMessage;
{{- end}}
import org.mockito.junit.jupiter.MockitoExtension;

import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;

/**
 * Unit tests for PlaceholderEventListener.
 *
 * <p>These tests verify that the listener can process events without errors.
 * For integration tests with {{if .UsesKafka}}Kafka{{else if .UsesRabbitMQ}}RabbitMQ{{else if .UsesSQS}}AWS SQS{{else if .UsesPubSub}}GCP Pub/Sub{{end}}, use
{{- if .UsesKafka}}
 * @EmbeddedKafka or Testcontainers.</p>
{{- else if .UsesRabbitMQ}}
 * Testcontainers with RabbitMQ.</p>
{{- else if .UsesSQS}}
 * Testcontainers with LocalStack.</p>
{{- else if .UsesPubSub}}
 * the GCP Pub/Sub emulator.</p>
{{- end}}
 */
@ExtendWith(MockitoExtension.class)
class PlaceholderEventListenerTest {

    @InjectMocks
    private PlaceholderEventListener listener;
{{if .UsesSQS}}
    @Mock
    private Acknowledgement acknowledgement;
{{else if .UsesPubSub}}
    @Mock
    private BasicAcknowledgeablePubsubMessage message;
{{end}}
    @Test
    void handlePlaceholderEvent_withCreatedEvent_processesSuccessfully() {
        // Arrange
        PlaceholderCreatedEvent event = PlaceholderCreatedEvent.create("123", "Test Placeholder");

        // Act & Assert
{{- if .UsesSQS}}
        assertDoesNotThrow(() -> listener.handlePlaceholderEvent(event, acknowledgement));
{{- else if .UsesPubSub}}
        assertDoesNotThrow(() -> listener.handlePlaceholderEvent(event, message));
{{- else}}
        assertDoesNotThrow(() -> listener.handlePlaceholderEvent(event));
{{- end}}
    }

    @Test
    void handlePlaceholderEvent_withMultipleEvents_processesAll() {
        // Arrange
        PlaceholderCreatedEvent event1 = PlaceholderCreatedEvent.create("1", "First");
        PlaceholderCreatedEvent event2 = PlaceholderCreatedEvent.create("2", "Second");

        // Act & Assert
        assertDoesNotThrow(() -> {
{{- if .UsesSQS}}
            listener.handlePlaceholderEvent(event1, acknowledgement);
            listener.handlePlaceholderEvent(event2, acknowledgement);
{{- else if .UsesPubSub}}
            listener.handlePlaceholderEvent(event1, message);
            listener.handlePlaceholderEvent(event2, message);
{{- else}}
            listener.handlePlaceholderEvent(event1);
            listener.handlePlaceholderEvent(event2);
{{- end}}
        });
    }
}
