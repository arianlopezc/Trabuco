server:
  port: ${SERVER_PORT:8080}

spring:
  application:
    name: {{.ProjectName}}-api
{{- if .HasModule "SQLDatastore"}}

  # Database configuration
  # Default ports use 5433 (PostgreSQL) or 3307 (MySQL) to avoid conflicts with local installations
  # Use docker-compose up -d to start the database container
  datasource:
{{- if eq .Database "postgresql"}}
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5433}/${DB_NAME:{{.ProjectName}}}
    username: ${DB_USERNAME:postgres}
    password: ${DB_PASSWORD:postgres}
    driver-class-name: org.postgresql.Driver
{{- else if eq .Database "mysql"}}
    url: jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3307}/${DB_NAME:{{.ProjectName}}}
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:root}
    driver-class-name: com.mysql.cj.jdbc.Driver
{{- else}}
    url: jdbc:h2:mem:{{.ProjectName}};DB_CLOSE_DELAY=-1
    username: ${DB_USERNAME:sa}
    password: ${DB_PASSWORD:}
    driver-class-name: org.h2.Driver
{{- end}}
    hikari:
      pool-name: {{.ProjectNamePascal}}Pool
      maximum-pool-size: ${DB_POOL_SIZE:10}
      minimum-idle: ${DB_POOL_MIN_IDLE:3}
      connection-timeout: 20000
      idle-timeout: 300000
      max-lifetime: 1200000

  # Flyway migrations
  flyway:
    enabled: ${FLYWAY_ENABLED:true}
    locations: classpath:db/migration
    baseline-on-migrate: true
{{- end}}
{{- if .HasModule "Shared"}}

# Resilience4j configuration
resilience4j:
  circuitbreaker:
    instances:
      default:
        registerHealthIndicator: true
        slidingWindowSize: 10
        minimumNumberOfCalls: 5
        failureRateThreshold: 50
        waitDurationInOpenState: 30s
        permittedNumberOfCallsInHalfOpenState: 3
{{- end}}

# Actuator endpoints
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always

# Logging
logging:
  level:
    {{.GroupID}}: ${LOG_LEVEL:DEBUG}
    org.springframework.web: INFO
    root: INFO
