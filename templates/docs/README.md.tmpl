# {{.ProjectName}}

A Java multi-module Maven project.

## Project Structure

```
{{.ProjectName}}/
├── pom.xml                      # Parent POM
{{- if .HasModule "Model"}}
├── Model/                       # DTOs, Entities, Enums
{{- end}}
{{- if .HasModule "SQLDatastore"}}
├── SQLDatastore/                # Repositories, Flyway migrations
{{- end}}
{{- if .HasModule "NoSQLDatastore"}}
├── NoSQLDatastore/              # NoSQL repositories, Configuration
{{- end}}
{{- if .HasModule "Jobs"}}
├── Jobs/                        # Background job request contracts
{{- end}}
{{- if .HasModule "Shared"}}
├── Shared/                      # Services, Circuit breaker
{{- end}}
{{- if .HasModule "API"}}
├── API/                         # REST endpoints (port 8080)
{{- end}}
{{- if .HasModule "Worker"}}
├── Worker/                      # Background job processor (port 8081)
{{- end}}
{{- if .HasModule "Events"}}
├── Events/                      # Event contracts for event-driven processing
{{- end}}
{{- if .HasModule "EventConsumer"}}
├── EventConsumer/               # Event listener ({{if .UsesKafka}}Kafka{{else if .UsesRabbitMQ}}RabbitMQ{{else if .UsesSQS}}AWS SQS{{else if .UsesPubSub}}GCP Pub/Sub{{end}}, port 8083)
{{- end}}
{{- if .NeedsDockerCompose}}
├── docker-compose.yml           # Local development services
├── .env.example                 # Environment variables template
{{- end}}
{{- if or (or (.HasModule "API") (.HasModule "Worker")) (.HasModule "EventConsumer")}}
├── .dockerignore                # Docker build exclusions
{{- end}}
└── README.md
```

## Prerequisites

- Java {{.JavaVersion}}
- Maven 3.9+
{{- if .NeedsDockerCompose}}
- Docker & Docker Compose (for local development)
{{- else if or (or (.HasModule "API") (.HasModule "Worker")) (.HasModule "EventConsumer")}}
- Docker (optional, for container builds)
{{- end}}

## Quick Start

{{- if .NeedsDockerCompose}}

### 1. Start local services

```bash
docker-compose up -d
```

This starts the required services for local development:
{{- if and (.HasModule "SQLDatastore") (eq .Database "postgresql")}}
- **PostgreSQL** — localhost:5433 (database: {{.ProjectName}}, user: postgres/postgres)
{{- else if and (.HasModule "SQLDatastore") (eq .Database "mysql")}}
- **MySQL** — localhost:3307 (database: {{.ProjectName}}, user: root/root)
{{- end}}
{{- if and (.HasModule "NoSQLDatastore") (eq .NoSQLDatabase "mongodb")}}
- **MongoDB** — localhost:27017 (database: {{.ProjectName}})
{{- else if and (.HasModule "NoSQLDatastore") (eq .NoSQLDatabase "redis")}}
- **Redis** — localhost:6379
{{- end}}
{{- if .WorkerNeedsOwnPostgres}}
- **PostgreSQL (JobRunr)** — localhost:5434 (database: {{.ProjectName}}_jobs, user: postgres/postgres)
{{- end}}
{{- if and (.HasModule "EventConsumer") (.UsesKafka)}}
- **Kafka** — localhost:9092
- **Zookeeper** — localhost:2181
{{- else if and (.HasModule "EventConsumer") (.UsesRabbitMQ)}}
- **RabbitMQ** — localhost:5672 (AMQP), localhost:15672 (Management UI: guest/guest)
{{- else if and (.HasModule "EventConsumer") (.UsesSQS)}}
- **LocalStack (SQS)** — localhost:4566
{{- else if and (.HasModule "EventConsumer") (.UsesPubSub)}}
- **Pub/Sub Emulator** — localhost:8085
{{- end}}

### 2. Build the project

```bash
mvn clean compile
```
{{- else}}

### Build the project

```bash
mvn clean compile
```
{{- end}}
{{- if .HasModule "API"}}

### {{if .NeedsDockerCompose}}3{{else}}2{{end}}. Run the API

```bash
cd API
mvn spring-boot:run
```

The API will be available at http://localhost:8080

**Health Check:**
```bash
curl http://localhost:8080/actuator/health
```
{{- end}}
{{- if .HasModule "Worker"}}

### {{if and .NeedsDockerCompose (.HasModule "API")}}4{{else if or .NeedsDockerCompose (.HasModule "API")}}3{{else}}2{{end}}. Run the Worker

```bash
cd Worker
mvn spring-boot:run
```

The Worker processes background jobs using [JobRunr](https://www.jobrunr.io/).

- **Health check:** http://localhost:8082/actuator/health (management port)
- **Dashboard:** http://localhost:8000 (no authentication by default)
{{- end}}
{{- if .HasModule "EventConsumer"}}

### {{if and (and .NeedsDockerCompose (.HasModule "API")) (.HasModule "Worker")}}5{{else if and .NeedsDockerCompose (or (.HasModule "API") (.HasModule "Worker"))}}4{{else if or (or .NeedsDockerCompose (.HasModule "API")) (.HasModule "Worker")}}3{{else}}2{{end}}. Run the EventConsumer

```bash
cd EventConsumer
mvn spring-boot:run
```

The EventConsumer listens for events from {{if .UsesKafka}}Kafka{{else if .UsesRabbitMQ}}RabbitMQ{{else if .UsesSQS}}AWS SQS{{else if .UsesPubSub}}GCP Pub/Sub{{end}} and processes them.

- **Health check:** http://localhost:8084/actuator/health (management port)
{{- end}}

## Build Commands

```bash
# Compile all modules
mvn clean compile

# Run tests
mvn test

# Package
mvn clean package

# Install to local repository
mvn clean install
```
{{- if or (or (.HasModule "API") (.HasModule "Worker")) (.HasModule "EventConsumer")}}

## Docker Build

Build and run the application containers:

```bash
{{- if .HasModule "API"}}
# Build API image
docker build -f API/Dockerfile -t {{.ProjectName}}-api .

# Run API container
docker run -p 8080:8080 {{.ProjectName}}-api
{{- end}}
{{- if .HasModule "Worker"}}

# Build Worker image
docker build -f Worker/Dockerfile -t {{.ProjectName}}-worker .

# Run Worker container
docker run -p 8081:8081 {{.ProjectName}}-worker
{{- end}}
{{- if .HasModule "EventConsumer"}}

# Build EventConsumer image
docker build -f EventConsumer/Dockerfile -t {{.ProjectName}}-eventconsumer .

# Run EventConsumer container
docker run -p 8083:8083 {{.ProjectName}}-eventconsumer
{{- end}}
```

Override JVM settings with the `JAVA_OPTS` environment variable:

```bash
{{- if .HasModule "API"}}
docker run -e JAVA_OPTS="-XX:MaxRAMPercentage=50.0" -p 8080:8080 {{.ProjectName}}-api
{{- else if .HasModule "Worker"}}
docker run -e JAVA_OPTS="-XX:MaxRAMPercentage=50.0" -p 8081:8081 {{.ProjectName}}-worker
{{- else}}
docker run -e JAVA_OPTS="-XX:MaxRAMPercentage=50.0" -p 8083:8083 {{.ProjectName}}-eventconsumer
{{- end}}
```
{{- end}}
{{- if .NeedsDockerCompose}}

## Docker Services

```bash
# Start services
docker-compose up -d

# Stop services (keeps data)
docker-compose stop

# Stop and remove containers (keeps data)
docker-compose down

# Stop and delete all data
docker-compose down -v

# View logs
docker-compose logs -f
```
{{- if or (and (.HasModule "SQLDatastore") (ne .Database "")) (.HasModule "NoSQLDatastore")}}

### Custom Database Configuration

If you prefer to use your own database instead of Docker:

1. Copy `.env.example` to `.env`
2. Update the values to match your database
3. The application will use these environment variables
{{- end}}
{{- end}}

## Modules

| Module | Description |
|--------|-------------|
{{- if .HasModule "Model"}}
| Model | DTOs, Entities, Enums, Exceptions |
{{- end}}
{{- if .HasModule "SQLDatastore"}}
| SQLDatastore | Database repositories, Flyway migrations |
{{- end}}
{{- if .HasModule "NoSQLDatastore"}}
| NoSQLDatastore | NoSQL repositories, {{if eq .NoSQLDatabase "mongodb"}}MongoDB{{else if eq .NoSQLDatabase "redis"}}Redis{{end}} configuration |
{{- end}}
{{- if .HasModule "Jobs"}}
| Jobs | Background job request contracts (shared between modules) |
{{- end}}
{{- if .HasModule "Shared"}}
| Shared | Business services, Circuit breaker utilities |
{{- end}}
{{- if .HasModule "API"}}
| API | REST controllers, Web configuration |
{{- end}}
{{- if .HasModule "Worker"}}
| Worker | Background job processor ([JobRunr](https://www.jobrunr.io/)) |
{{- end}}
{{- if .HasModule "Events"}}
| Events | Event contracts for event-driven processing |
{{- end}}
{{- if .HasModule "EventConsumer"}}
| EventConsumer | Event listener ({{if .UsesKafka}}Kafka{{else if .UsesRabbitMQ}}RabbitMQ{{else if .UsesSQS}}AWS SQS{{else if .UsesPubSub}}GCP Pub/Sub{{end}}) |
{{- end}}

## Configuration
{{- if or (.HasModule "API") (.HasModule "Worker")}}

### General Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `SPRING_PROFILES_ACTIVE` | Spring profile — `local` for console logs, other values for JSON | local |
{{- if .HasModule "API"}}
| `SERVER_PORT` | API server port | 8080 |
| `LOG_LEVEL` | Application log level | DEBUG |
{{- end}}

### Logging

- **`local` profile** — colored console output for development
- **Other profiles** — structured JSON output (suitable for log aggregation)
- Log levels are configured in each module's `application.yml`
{{- end}}
{{- if .HasModule "SQLDatastore"}}

### Database Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
{{- if eq .Database "postgresql"}}
| `DB_HOST` | PostgreSQL host | localhost |
| `DB_PORT` | PostgreSQL port | 5433 |
{{- else if eq .Database "mysql"}}
| `DB_HOST` | MySQL host | localhost |
| `DB_PORT` | MySQL port | 3307 |
{{- end}}
| `DB_NAME` | Database name | {{.ProjectName}} |
| `DB_USERNAME` | Database user | {{if eq .Database "postgresql"}}postgres{{else if eq .Database "mysql"}}root{{end}} |
| `DB_PASSWORD` | Database password | {{if eq .Database "postgresql"}}postgres{{else if eq .Database "mysql"}}root{{end}} |
{{- end}}
{{- if .HasModule "NoSQLDatastore"}}

### NoSQL Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
{{- if eq .NoSQLDatabase "mongodb"}}
| `MONGODB_URI` | MongoDB connection URI | mongodb://localhost:27017/{{.ProjectName}} |
{{- else if eq .NoSQLDatabase "redis"}}
| `REDIS_HOST` | Redis host | localhost |
| `REDIS_PORT` | Redis port | 6379 |
{{- end}}
{{- end}}
{{- if .HasModule "Worker"}}

### Worker Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `JOBRUNR_DASHBOARD_ENABLED` | Enable JobRunr dashboard | true |
| `JOBRUNR_DASHBOARD_PORT` | JobRunr dashboard port | 8000 |
{{- if .JobRunrUsesSql}}
| `SPRING_DATASOURCE_URL` | JobRunr database URL | {{if and (.HasModule "SQLDatastore") (eq .Database "postgresql")}}jdbc:postgresql://localhost:5433/{{.ProjectName}}{{else if and (.HasModule "SQLDatastore") (eq .Database "mysql")}}jdbc:mysql://localhost:3307/{{.ProjectName}}{{else}}jdbc:postgresql://localhost:5434/{{.ProjectName}}_jobs{{end}} |
| `SPRING_DATASOURCE_USERNAME` | JobRunr database user | {{if and (.HasModule "SQLDatastore") (eq .Database "mysql")}}root{{else}}postgres{{end}} |
| `SPRING_DATASOURCE_PASSWORD` | JobRunr database password | {{if and (.HasModule "SQLDatastore") (eq .Database "mysql")}}root{{else}}postgres{{end}} |
{{- else if .JobRunrUsesMongoDB}}
| `SPRING_DATA_MONGODB_URI` | JobRunr MongoDB URI | mongodb://localhost:27017/{{.ProjectName}} |
{{- end}}
{{- end}}
{{- if .HasModule "EventConsumer"}}

### EventConsumer Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
{{- if .UsesKafka}}
| `KAFKA_BOOTSTRAP_SERVERS` | Kafka broker addresses | localhost:9092 |
| `KAFKA_CONSUMER_GROUP` | Consumer group ID | {{.ProjectName}}-consumers |
{{- else if .UsesRabbitMQ}}
| `RABBITMQ_HOST` | RabbitMQ host | localhost |
| `RABBITMQ_PORT` | RabbitMQ port | 5672 |
| `RABBITMQ_USERNAME` | RabbitMQ username | guest |
| `RABBITMQ_PASSWORD` | RabbitMQ password | guest |
| `RABBITMQ_VHOST` | RabbitMQ virtual host | / |
{{- else if .UsesSQS}}
| `AWS_REGION` | AWS region | us-east-1 |
| `AWS_ACCESS_KEY_ID` | AWS access key | test |
| `AWS_SECRET_ACCESS_KEY` | AWS secret key | test |
| `SQS_ENDPOINT` | SQS endpoint (for LocalStack) | (empty - uses AWS) |
| `SQS_QUEUE_PLACEHOLDER` | SQS queue name | placeholder-events |
{{- else if .UsesPubSub}}
| `GCP_PROJECT_ID` | GCP project ID | local-project |
| `PUBSUB_EMULATOR_HOST` | Pub/Sub emulator host (for local dev) | (empty - uses GCP) |
| `PUBSUB_SUBSCRIPTION_PLACEHOLDER` | Subscription name | placeholder-events-sub |
| `PUBSUB_TOPIC_PLACEHOLDER` | Topic name | placeholder-events |
{{- end}}
{{- end}}
{{- if .HasModule "Shared"}}

### Circuit Breaker Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `CB_FAILURE_RATE_THRESHOLD` | Failure rate to open circuit (%) | 50 |
| `CB_SLOW_CALL_DURATION_MS` | Slow call threshold (ms) | 2000 |
| `CB_WAIT_DURATION_MS` | Wait time in open state (ms) | 30000 |
{{- end}}

---

Generated with [Trabuco](https://github.com/arianlopezc/Trabuco)
