# {{.ProjectName}} — AI Agent Guide

This file provides a cross-tool baseline for any AI coding agent working on this project.

## Project Structure

Java {{.JavaVersion}}+ multi-module Maven project (Spring Boot):

| Module | Purpose |
|--------|---------|
{{- if .HasModule "Model"}}
| **Model** | Entities, DTOs, Enums (Immutables) |
{{- end}}
{{- if .HasModule "SQLDatastore"}}
| **SQLDatastore** | Spring Data JDBC, Flyway migrations |
{{- end}}
{{- if .HasModule "NoSQLDatastore"}}
| **NoSQLDatastore** | {{if eq .NoSQLDatabase "mongodb"}}MongoDB{{else}}Redis{{end}} repositories |
{{- end}}
{{- if .HasModule "Shared"}}
| **Shared** | Business services, circuit breaker |
{{- end}}
{{- if .HasModule "API"}}
| **API** | REST controllers, OpenAPI |
{{- end}}
{{- if .HasModule "Worker"}}
| **Worker** | JobRunr background jobs |
{{- end}}
{{- if .HasModule "EventConsumer"}}
| **EventConsumer** | {{if .UsesKafka}}Kafka{{else if .UsesRabbitMQ}}RabbitMQ{{else if .UsesSQS}}SQS{{else}}Pub/Sub{{end}} listeners |
{{- end}}
{{- if .HasModule "MCP"}}
| **MCP** | AI tool server (Model Context Protocol) |
{{- end}}

## Build Commands

```bash
mvn clean compile          # Build all modules
mvn test                   # Run all tests
mvn clean package          # Package all modules
```

## Quality Commands

```bash
mvn spotless:apply         # Auto-format all Java files (Google Java Format)
mvn spotless:check         # Check formatting without modifying (CI)
mvn enforcer:enforce       # Check dependency and version rules
```

## Module Dependency Rules

```
Model -> (none)
{{- if .HasModule "SQLDatastore"}}
SQLDatastore -> Model
{{- end}}
{{- if .HasModule "NoSQLDatastore"}}
NoSQLDatastore -> Model
{{- end}}
{{- if .HasModule "Shared"}}
Shared -> Model{{if .HasModule "SQLDatastore"}}, SQLDatastore{{end}}{{if .HasModule "NoSQLDatastore"}}, NoSQLDatastore{{end}}
{{- end}}
{{- if .HasModule "API"}}
API -> Model, Shared
{{- end}}
{{- if .HasModule "Worker"}}
Worker -> Model, Shared, Jobs
{{- end}}
{{- if .HasModule "EventConsumer"}}
EventConsumer -> Model, Shared, Events
{{- end}}
```

Never import from API in Worker/EventConsumer or vice versa.

## Key Patterns

- **Immutables**: Use `ImmutableX.builder()...build()` for all DTOs and entities
- **Constructor injection**: All fields `private final`, no `@Autowired` on fields
- **Modern Java**: Streams over loops, pattern matching, `Optional.map()`/`orElse()`
- **Method size**: Max 30 lines, extract helpers for complex logic

## Testing

- **Write tests BEFORE implementation code** — one test at a time, not in bulk
- **Fix implementation to make tests pass** — never modify tests to pass
- **Test behavior, not internals** — test through public interfaces, not private methods
- **Naming**: `should_ExpectedBehavior_When_Condition` with Given/When/Then comments
- **Cover all categories**: happy path, not-found/empty, validation failures, error conditions
- **Full guide**: `.ai/prompts/testing-guide.md` | **Standards**: `.ai/prompts/JAVA_CODE_QUALITY.md` (Section 7)

## Quality Specification

For the full coding standards, read: `.ai/prompts/JAVA_CODE_QUALITY.md`

## Why This Architecture

| Decision | Why |
|----------|-----|
| Spring Data JDBC over JPA | No lazy loading surprises, no proxy magic, no @Transactional gotchas. What you write is what runs. |
| Immutables over Lombok/records | Type-safe builders, true immutability, generated equals/hashCode. Records are used only at persistence boundaries. |
| Multi-module over monolith | Enforces dependency boundaries at compile time. API can't import Worker code. Clear ownership. |
| Constructor injection only | Testable without Spring context. All dependencies explicit. No hidden @Autowired magic. |
{{- if .HasModule "Worker"}}
| JobRunr over Quartz | Modern API, dashboard included, supports fire-and-forget/delayed/recurring/batch without XML config. |
{{- end}}
{{- if .HasModule "EventConsumer"}}
| Sealed interfaces for events | Type-safe contracts. Compiler enforces exhaustive handling. New event types require explicit handler decisions. |
{{- end}}

## Using Placeholder Code as Patterns

The generated code includes working `Placeholder*` classes as reference implementations. When creating new entities, endpoints, jobs, or events, follow these patterns:

| Task | Look at | Then read |
|------|---------|-----------|
| Add entity | `Placeholder.java`, `PlaceholderRecord.java` | `.ai/prompts/add-entity.md` |
{{- if .HasModule "API"}}
| Add endpoint | `PlaceholderController.java`, `PlaceholderService.java` | `.ai/prompts/add-endpoint.md` |
{{- end}}
{{- if .HasModule "Worker"}}
| Add job | `ProcessPlaceholderJobRequest.java`, handler | `.ai/prompts/add-job.md` |
{{- end}}
{{- if .HasModule "EventConsumer"}}
| Add event | `PlaceholderEvent.java`, listener | `.ai/prompts/add-event.md` |
{{- end}}

**Do not delete placeholder classes until you have at least one real implementation** — they serve as compilation-verified examples.

## What This Project Does NOT Include

This project was scaffolded by Trabuco. It includes production-ready infrastructure but NOT:

- **Authentication/Authorization** — Add Spring Security (OAuth2, JWT, or session-based)
- **Custom business logic** — Implement in `Shared/src/main/java/.../shared/service/`
- **Production database schema** — Only placeholder migration exists; add your tables
- **Pagination/filtering** — Add to repository queries and controller parameters
- **API versioning** — Add URL or header-based versioning as needed
- **Rate limiting** — Add Spring Cloud Gateway or Bucket4j
- **Caching** — Add `@Cacheable` with Redis or in-memory cache
- **Kubernetes/deployment** — Docker Compose for local dev only

For guidance on adding these capabilities, see `.ai/prompts/extending-the-project.md`.
{{- if .HasModule "MCP"}}

## Review Tools (MCP)

When the MCP server is running, use these tools for efficient code reviews:

| Tool | Description |
|------|-------------|
| `get-review-context` | Get only the relevant quality rules for files being reviewed |
| `record-review-finding` | Log a finding to `.ai/review-log.jsonl` (append-only) |
| `get-review-stats` | View aggregate stats and recurring patterns |

Review findings are stored in `.ai/review-log.jsonl` (JSON Lines, append-only).
Use `get-review-stats` to identify recurring issues across reviews.
{{- end}}
